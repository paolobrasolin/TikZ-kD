%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                              %
%  Copyright 2015 by Paolo Brasolin <paolo.brasolin@gmail.com>                 %
%                                                                              %
%  This file is part of kD.                                                    %
%                                                                              %
%  kD is free software: you can redistribute it and/or modify                  %
%  it under the terms of the GNU General Public License as published by        %
%  the Free Software Foundation, either version 3 of the License, or           %
%  (at your option) any later version.                                         %
%                                                                              %
%  kD is distributed in the hope that it will be useful,                       %
%  but WITHOUT ANY WARRANTY; without even the implied warranty of              %
%  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the               %
%  GNU General Public License for more details.                                %
%                                                                              %
%  You should have received a copy of the GNU General Public License           %
%  along with kD.  If not, see <http://www.gnu.org/licenses/>.                 %
%                                                                              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% ############################################################ REQUIRE CONTEXT #

\newif\ifConTeXt

% Trick stolen from iftex. The second line is expanded inside the group so
% the global scope isn't polluted by \csname defining the token.
\begingroup\expandafter\expandafter\expandafter\endgroup\expandafter
  \ifx\csname starttext\endcsname\relax\ConTeXtfalse\else\ConTeXttrue\fi

\def\RequireConTeXt%
  {\ifConTeXt\else\begingroup
     \errorcontextlines=-1\relax
     \newlinechar=10\relax
     \let~\space
     \errmessage{^^J^^J
~~~~~_________________________^^J
~~~~~|~~~~~~~~~~~~~~~~~~~~~~~|^^J
~~~~~|~~ ConTeXt (MKIV) is ~~|^^J
~~~~~|~ required to compile ~|^^J
~~~~~|~ this document. ~~~~~~|^^J
~~~~~|~~~~~~~~~~~~~~~~~~~~~~~|^^J
~~~~~|~~~~~~~~~~~~~~~~~ -P. ~|^^J
~~~~~|~~~~~~~~~~~~~~~~~~~~~~~|^^J
~~~~~|_______________________|^^J^^J^^J}%
   \endgroup\fi}

\RequireConTeXt

% ##############################################################################

\usemodule[tikz]
\usetikzlibrary[calc]
\usetikzlibrary[positioning]

\usetikzlibrary[kD]

% ==============================================================================

\setuplayout
  [grid=yes,
   backspace=0.125\paperwidth,width=middle,
   topspace=0.088\paperheight,height=middle,
   header=0bp,footer=0bp]
\setuphead[title][alternative=margin,align=flushright,page=no]
\setuppagenumbering[location=]
\setuptyping[option=TEX,style=tx]
\setupframed[width=broad,align=middle,frame=off]

\def\DoExample#1#2{%
  \title{#1}
  \framed{\begingroup\input examples/#2 \endgroup}
  {\tfxx\typefile[TEX]{examples/#2}}
}

% ####################################################################### TEXT #

\starttext

\DoExample{Snake Lemma}{snake_lemma}
\DoExample{K4 associahedron}{k4_associahedron}
%\DoExample{K5 associahedron}{k5_associahedron}
\DoExample{WIP}{chain}
\DoExample{Pullback}{pullback}

\stoptext

% #################################################################### THE END #
